<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>SSAFY Auth - 독스 auth</title>

    <!-- Custom fonts for this template-->
    <link th:href="@{/vendor/fontawesome-free/css/all.min.css}" rel="stylesheet" type="text/css">
    <link th:href="@{https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i}"
          rel="stylesheet">

    <!-- Custom styles for this template-->
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}">
    <link th:href="@{/css/sb-admin-2.min.css}" rel="stylesheet">
    <link th:href="@{/css/main.css}" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <script th:src="@{/vendor/jquery/jquery.min.js}"></script>
    <script th:src="@{/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/vendor/jquery-easing/jquery.easing.min.js}"></script>
    <!-- 페이지 로딩될 때 데이터 fetch -->
    <script th:src="@{/js/sb-admin-2.min.js}"></script>
    <script th:inline="javascript">
        function getCookie(name) {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i];
                while (cookie.charAt(0) === ' ') {
                    cookie = cookie.substring(1);
                }
                if (cookie.indexOf(name + "=") === 0) {
                    return cookie.substring(name.length + 1, cookie.length);
                }
            }
            return undefined;
        }

        window.onload = function () {
            loadData();
            loadTeams();
            var teamSeq = window.location.pathname.match(/\/teams\/(\d+)\/summary/)[1];
            loadTeamData(teamSeq);
        };

        function loadData() {
            var token = getCookie("access_token")
            $.ajax({
                url: 'http://localhost:8090/api/team',
                type: 'GET',
                contentType: 'application/json',
                headers: {
                    "Authorization": 'Bearer ' + token
                },
                success: function (response) {
                    displayTeams(response.list);
                    displayTeamInfo(response.list[0]);
                },
                error: function (xhr, status, error) {
                    console.error('Error loading data:', error);
                }
            });
        }

        function loadTeams() {
            var token = getCookie("access_token");
            $.ajax({
                url: 'http://localhost:8090/api/team',
                type: 'GET',
                headers: {
                    "Authorization": 'Bearer ' + token
                },
                success: function (response) {
                    populateSidebar(response.list);
                },
                error: function (xhr, status, error) {
                    console.error('Error loading data:', error);
                }
            });
        }

        function populateSidebar(data) {
            var container = document.getElementById('teamNavContainer');
            container.innerHTML = '';
            data.forEach(function (team, index) {
                var teamNavItem = document.createElement('li');
                teamNavItem.classList.add('nav-item');
                teamNavItem.innerHTML = `
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapse${index}"
                    aria-expanded="true" aria-controls="collapse${index}">
                    <i class="fas fa-fw fa-cog"></i>
                    <span>${team.teamName}</span>
                </a>
                <div id="collapse${index}" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">관리</h6>
                        <a class="collapse-item" href="/teams/${team.teamSeq}/summary">요약 정보</a>
                        <a class="collapse-item" href="/teams/${team.teamSeq}/dashboard">대시보드</a>
                        <a class="collapse-item" href="/teams/${team.teamSeq}/consents">동의 항목</a>
                        <a class="collapse-item" href="/teams/${team.teamSeq}/country-ip">국가 아이피 관리</a>
                        <a class="collapse-item" href="/teams/${team.teamSeq}/management">팀 관리</a>
                        <a class="collapse-item" href="/teams/${team.teamSeq}/settings">설정</a>
                    </div>
                </div>`;
                container.appendChild(teamNavItem);
            });
        }


        function getCookie(name) {
            let value = `; ${document.cookie}`;
            let parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }


    </script>


    <style>
        .country-block-manager {
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .blocked-country {
            padding: 8px 16px;
            background-color: #dc3545;
            color: white;
            border-radius: 15px;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .blocked-country button {
            border: none;
            background: none;
            color: white;
            cursor: pointer;
        }

        .blocked-country button:hover {
            color: #ccc;
        }

        #wrapper {
            padding-left: 0;
            padding-right: 0;
        }

        @media (max-width: 768px) {
            .form-inline {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body id="page-top" th:class="${bodyClass}">
<div class="header" th:replace="~{layouts/header :: header}"></div>
<!-- Page Wrapper -->
<div id="wrapper">
    <!-- Sidebar -->
    <div class="header" th:replace="~{layouts/sidebar :: sidebar}"></div>
    <div class="col-xl-10 col-lg-12 col-md-9">
        <div class="card o-hidden border-0 shadow-lg my-5">
            <div class="card-body p-0">
                <div class="col">
                    <h1>SSAFY OAUTH</h1>
                    <div class="api-section">
                        <h2>이해하기</h2>
                        <div class="api-description">
                            <p>이 섹션에서는 인증 관련 API를 설명합니다.</p>
                        </div>
                        <br>
                        <hr>
                        <div class="introduce">
                            <h3>기능소개</h3>
                            <div class="request">
                                싸피어스 로그인은 싸피어스계정으로 다양한 서비스에 로그인할 수 있도록 하는 소셜 로그인 서비스입니다.
                                기능은 다음과 같습니다.
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>기능</th>
                                        <th>싸피 어스 로그인</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <!-- 서버로부터 받은 features 리스트를 반복 -->
                                    <tr>
                                        <td>싸피 어스 계정으로 사용자 로그인</td>
                                        <td>✔</td>
                                    </tr>
                                    <tr>
                                        <td>사용자 고유 식별 정보 제공 및 필수로 프로필 사진과 이메일 제공</td>
                                        <td>✔</td>
                                    </tr>
                                    <tr>
                                        <td>이름, 성별, 트랙, 학번 등 서비스 가입에 필요한 정보 제공</td>
                                        <td>✔</td>
                                    </tr>
                                    <tr>
                                        <td>싸피 어스 회원가입 기능 제공</td>
                                        <td>✔</td>
                                    </tr>
                                    <tr>
                                        <td>클라이언트 별 로그인 기록 제공</td>
                                        <td>✔</td>
                                    </tr>
                                    <tr>
                                        <td>로그인 국가 차단 기능 제공</td>
                                        <td>✔</td>
                                    </tr>
                                    </tbody>
                                </table>
                            <div class="question-box">
                                <h4>애플리케이션</h4>
                                <p>싸피어스 로그인을 사용하려면 싸피어스(이하 개발자 웹사이트) 애플리케이션(이하 앱)이 필요합니다.</p>
                            </div>
                            </div>
                            <div class="ssafy-login">
                                <h3>싸피어스 로그인</h3>
                                <p>
                                    싸피어스 로그인은 OAuth 2.0 기반의 소셜 로그인 서비스입니다. 싸피어스 로그인을 사용하면 사용자가 싸피어스계정으로 손쉽게 서비스에 로그인할 수 있습니다. 서비스는 서비스 ID 및 비밀번호를 입력받고 검증하는 과정을 직접 구현하지 않고도 사용자에 대한 인증과 인가를 간편하고 안전하게 처리할 수 있습니다.
                                </p>


                            </div>

                            <table class="table table-bordered">
                                <thead>
                                <tr>
                                    <th>구분</th>
                                    <th>설명</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>인증(Authentication)</td>
                                    <td>
                                        사용자 인증, 싸피어스 API 호출 권한 부여
                                    </td>
                                </tr>
                                <tr>
                                    <td>인가(Authorization)</td>
                                    <td>
                                        액세스 토큰 재발급에 사용 <br>
                                        유효한 리프레시 토큰이 있다면 사용자가 매번 싸피어스 정보를 입력하는 인증 절차를 거치지 않아도 액세스 토큰 재발급 가능
                                    </td>
                                    <td></td>
                                </tr>
                                </tbody>
                            </table>


                            <h4>토큰</h4>
                            <p>
                                토큰은 사용자의 싸피어스 로그인 인증 및 인가 정보를 담은 권한 증명으로, 싸피어스 API 호출에 사용됩니다. <br>
                                싸피어스 로그인은 OAuth 2.0 표준 규격에 따라 액세스 토큰(Access token), 리프레시 토큰(Refresh token) 두 종류의 토큰을 발급합니다.  <br>
                                OpenID Connect 사용 시, 사용자 인증 정보를 담은 ID 토큰을 함께 발급합니다. 각 토큰의 역할과 만료 시간을 표로 정리하면 다음과 같습니다.
                            </p>
                            <table class="table table-bordered">
                                <thead>
                                <tr>
                                    <th>구분</th>
                                    <th>설명</th>
                                    <th>만료 시간</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>액세스 토큰 (Access token)</td>
                                    <td>
                                        ID와 비밀번호로 사용자 신원을 확인 <br>
                                        각 서비스에 사용자가 싸피어스계정으로 로그인할 수 있는 기능 지원 <br>
                                        참고: OpenID Connect 지원, 로그인 세션 대신 사용 가능한 ID 토큰 제공 가능
                                    </td>
                                    <td>60분</td>
                                </tr>
                                <tr>
                                    <td>리프레시 토큰 (Refresh token)</td>
                                    <td>
                                        사용자 개인정보와 같은 자원(Resource)에 대한 접근 권한 획득 <br>
                                        사용자 동의를 바탕으로 사용자 정보나 기능에 대한 접근 권한을 토큰 형태로 서비스에 부여
                                    </td>
                                    <td>10일</td>
                                </tr>

                                <tr>
                                    <td>ID 토큰 (ID token)</td>
                                    <td>
                                        싸피어스 로그인 사용자의 인증 정보를 제공하는 토큰
                                    </td>
                                    <td>엑세스 토큰과 동일</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="process">
                            <img src="/image/code.PNG" width="100%">
                            <img src="/image/token.PNG" width="100%">
                            <img src="/image/userInfo.PNG" width="100%">
                            1. 싸피어스 로그인
                        </div>
                    </div>
                </div>
            </div>
        </div>
</div>

</div>
<!-- Footer -->
<div class="footer" th:replace="~{layouts/footer :: footer}"></div>
</body>
</html>
